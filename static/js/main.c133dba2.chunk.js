(this.webpackJsonpconway=this.webpackJsonpconway||[]).push([[0],{31:function(e,t,r){},32:function(e,t,r){},48:function(e,t,r){"use strict";r.r(t);var n=r(10),i=r(8),s=r.n(i),a=r(18),c=r.n(a),o=(r(31),r(0)),l=r(1),u=r(3),d=r(2),p=r(6),h=(r(32),r(9));function f(e){return Object(n.jsx)("td",{onClick:e.handleClick,className:"cell",children:e.val})}var j=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).grid=Object(h.a)(Array(n.props.len).keys()),n}return Object(l.a)(r,[{key:"render",value:function(){var e=this;return Object(n.jsx)("tr",{children:this.grid.map((function(t){var r=e.props.offset*e.props.len+t;return Object(n.jsx)(f,{handleClick:function(r){return e.props.handleCellClick(r,t,e.props.offset)},val:e.props.vals[t]},r)}))})}}]),r}(s.a.Component);function v(e){return Object(n.jsx)("div",{})}var b=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).setTimer=function(){e.timerID=setInterval((function(){return e.tick()}),e.state.interval),e.setState((function(e,t){return Object(p.a)(Object(p.a)({},e),{},{timerSet:!0})}))},e.unsetTimer=function(){clearInterval(e.timerID),e.setState((function(e,t){return Object(p.a)(Object(p.a)({},e),{},{timerSet:!1})}))},e.toggleTimer=function(){e.state.timerSet?e.unsetTimer():e.setTimer()},e.changeInterval=function(t){var r=parseInt(t.target.value,10);e.setState({interval:3e4/r})},e}return Object(l.a)(r,[{key:"tick",value:function(){throw new Error("tick not implemented")}},{key:"clear",value:function(){throw new Error("clear not implemented")}},{key:"subrender",value:function(){throw new Error("subrender not implemented")}},{key:"componentWillUnmount",value:function(){this.unsetTimer()}},{key:"render",value:function(){return Object(n.jsxs)("div",{children:[this.subrender(),Object(n.jsxs)("div",{className:"controls",children:[Object(n.jsx)("button",{onClick:this.toggleTimer,children:this.state.timerSet?"Pause":"Play"}),Object(n.jsx)("span",{className:"spacer"}),Object(n.jsx)("button",{onClick:this.clear,children:"Clear"}),Object(n.jsx)("span",{className:"spacer"}),"Tempo:\xa0",Object(n.jsx)("input",{className:"bpm",onChange:this.changeInterval,disabled:this.state.timerSet,type:"number",min:"50",max:"300",placeholder:parseInt(3e4/this.state.interval).toString()})]})]})}}]),r}(s.a.Component),O=r(17),g=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e))._addWidgetInternal=function(e,t,r){var i=JSON.parse(JSON.stringify(e.widgets));i[e.ctr]={idx:e.ctr,pos:[t,r],dir:0};var s=e.synths.slice();return s.push((new O.c).connect(n.reverb).connect(n.feedback).toDestination()),Object(p.a)(Object(p.a)({},e),{},{synths:s,widgets:i,vals:n.updateVals(i),ctr:e.ctr+1})},n.clear=function(){n.setState((function(e,t){return Object(p.a)(Object(p.a)({},e),{},{widgets:{},vals:n.updateVals({})})}))},n.handleCellClick=function(e,t,r){n.setState((function(e,i){var s=Object.values(e.widgets).filter((function(e){return e.pos[0]===t&&e.pos[1]===r})).flat();if(0===s.length)return n._addWidgetInternal(e,t,r);if(1===s.length){var a=s[0].idx,c=JSON.parse(JSON.stringify(e.widgets)),o=c[a].dir;return o<3?c[a].dir=(o+1)%4:delete c[a],Object(p.a)(Object(p.a)({},e),{},{widgets:c,vals:n.updateVals(c)})}}))},n.grid=Object(h.a)(Array(n.props.gridsize).keys()),n.reverb=new O.b(.3).toDestination(),n.feedback=new O.a(.3,.2).toDestination(),n.state={widgets:{},synths:[],vals:n.initVals(),interval:200,ctr:0},n}return Object(l.a)(r,[{key:"initVals",value:function(){var e=this;return new Array(this.props.gridsize).fill("").map((function(t){return new Array(e.props.gridsize).fill("")}))}},{key:"updateVals",value:function(e){var t=this.initVals();return Object.values(e).forEach((function(e){return t[e.pos[1]][e.pos[0]]+=r.getArrow(e.dir)})),t}},{key:"tick",value:function(){var e=this;this.setState((function(t,r){var n={};return Object.keys(t.widgets).forEach((function(r){n[r]=e.updateWidget(t.widgets[r])})),n=e.handleCollisions(n),Object(p.a)(Object(p.a)({},t),{},{widgets:n,vals:e.updateVals(n)})}));var t=this.playSounds();this.highlightCells(t)}},{key:"playSounds",value:function(){var e=this,t={cols:[],rows:[]};return Object.keys(this.state.widgets).forEach((function(r){var n=e.state.widgets[r],i=e.state.synths[r];e.didHitWall(n.pos,n.dir)&&(e.makeSound(n.pos,n.dir,i),n.dir%2?t.rows.push(n.pos[1]):t.cols.push(n.pos[0]))})),t}},{key:"highlightCells",value:function(e){for(var t=[],r=0;r<this.props.gridsize;r++)for(var n=0;n<this.props.gridsize;n++)-1===e.rows.indexOf(r)&&-1===e.cols.indexOf(n)||t.push(r*this.props.gridsize+n);var i=document.getElementsByClassName("cell");t.forEach((function(e){i[e].innerText||(i[e].className="cell flashing")})),setTimeout((function(){return t.forEach((function(e){i[e].innerText||(i[e].className="cell")}))}),75)}},{key:"didHitWall",value:function(e,t){var r=this.props.gridsize-1;return 0===t&&0===e[1]||1===t&&e[0]===r||2===t&&e[1]===r||3===t&&0===e[0]}},{key:"makeSound",value:function(e,t,r){var n=0,i=this.props.gridsize-1;n=t%2!==1||0!==e[0]&&e[0]!==i?e[0]:i-e[1],r.triggerAttackRelease(this.props.scale[n%this.props.scale.length],"8n",O.d(),.3)}},{key:"updateWidget",value:function(e){var t=JSON.parse(JSON.stringify(e));return this.didHitWall(t.pos,t.dir)&&(t.dir=(t.dir+2)%4),2===t.dir?t.pos=[t.pos[0],(t.pos[1]+1+this.props.gridsize)%this.props.gridsize]:0===t.dir?t.pos=[t.pos[0],(t.pos[1]-1+this.props.gridsize)%this.props.gridsize]:1===t.dir?t.pos=[(t.pos[0]+1+this.props.gridsize)%this.props.gridsize,t.pos[1]]:t.pos=[(t.pos[0]-1+this.props.gridsize)%this.props.gridsize,t.pos[1]],t}},{key:"handleCollisions",value:function(e){var t=Object.values(e).map((function(e){return[e.idx,e.pos.join(",")]})),r=Object.values(this.groupBy(t,1,0));return r.filter((function(e){return e.length>2})).flat().forEach((function(t){e[t].dir=(e[t].dir+2)%4})),r.filter((function(e){return 2===e.length})).flat().forEach((function(t){e[t].dir=(e[t].dir+1)%4})),e}},{key:"groupBy",value:function(e,t,r){return e.reduce((function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n[r]),e}),{})}},{key:"subrender",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsx)("table",{children:Object(n.jsx)("tbody",{children:this.grid.map((function(t){return Object(n.jsx)(j,{handleCellClick:e.handleCellClick,offset:t,vals:e.state.vals[t],len:e.props.gridsize},t)}))})}),Object(n.jsx)("br",{}),Object.values(this.state.widgets).map((function(e){return Object(n.jsx)(v,{idx:e.idx,dir:e.dir,pos:e.pos},e.idx)}))]})}}],[{key:"getArrow",value:function(e){return 0===e?"\u2191":1===e?"\u2192":2===e?"\u2193":"\u2190"}}]),r}(b),m=r(19),y=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(l.a)(r,[{key:"render",value:function(){return Object(n.jsx)("div",{className:"App",children:Object(n.jsx)(g,{gridsize:9,scale:["E3","B3","C4","D4","E4","F#4","G4","B4","D5"]})})}}]),r}(i.Component),k=Object(m.b)((function(e){return Object(p.a)({},e)}))(y),w=r(14),x=r(25),C=Object(w.c)({});c.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(m.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(w.d)(C,e,Object(w.a)(x.a))}(),children:Object(n.jsx)(k,{})})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.c133dba2.chunk.js.map